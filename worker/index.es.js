import e from"unistore";function t(e,t){if(Array.isArray(e)){e=e.slice(0,t.length);for(var r=0;r<t.length;r++)void 0!==t[r]&&(e[r]=n(t[r],e[r]))}else for(var i in e=function(e,t){for(var n in t)e[n]=t[n];return e}({},e),t)t.hasOwnProperty(i)&&(void 0===t[i]?delete e[i]:e[i]=n(t[i],e[i]));return e}function n(e,n){return null!=n&&null!=e&&"object"==typeof n&&"object"==typeof e?t(n,e):e}export default function(n){var r=e(n),i=r.actions={},a={},o=0,f=[],s=[];for(var p in n)a[p]=n[p];function u(e){1===s.push(e)&&setTimeout(c)}function c(){"function"==typeof postMessage&&1===postMessage.length&&postMessage(s),s.length=0}function l(e){if(o>0)return f.push(e);var n=e.type,a=e.id,s=e.overwrite,p=e.update,c=e.action;if("@@STATE"===n)!0===e.partial&&(p=t(r.getState(),p),s=!0),r.setState(p,!0===s,c);else if("@@ACTION"===n){var l=i[c.type];c.params?l.apply(i,c.params):l.call(i,c.payload),a&&u({type:"@@ACTIONCOMPLETE",id:a})}}return"function"==typeof addEventListener&&addEventListener("message",function(e){var t=e.data;if("object"!=typeof t);else if("pop"in t)if(1===t.length)l(t[0]);else for(var n=0;n<t.length;n++)l(t[n]);else l(t)}),r.subscribe(function(e,t,n,r){a=e,u({type:"@@STATE",update:n,action:t&&t.name,partial:!0,params:r})}),r.registerActions=function(e){for(var t in"function"==typeof e&&(e=e(r)),e)i[t]=r.action(e[t])},r.freeze=function(){o++},r.unfreeze=function(){if(!--o){var e=f;f=[];for(var t=0;t<e.length;t++)l(e[t])}},u({type:"@@STATE",initial:!0,update:r.getState()}),r};
//# sourceMappingURL=index.es.js.map
